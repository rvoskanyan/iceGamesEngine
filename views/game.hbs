<main class="gamePage js-gamePage">
    <div class="breadcrumbs contentContainer">
        <div class="item">
            <a class="btn link" href="/">Главная</a>
        </div>
        <div class="item">
            <a class="btn link" href="/games">Каталог</a>
        </div>
        <div class="current">
            {{product.name}}
        </div>
    </div>
    <div class="cover blackout blackout-left blackout-bottom slide active js-slide">
        <img class="img" src="{{websiteAddress}}{{product.coverImg}}" alt="{{product.name}}" title="{{product.name}}">
        <div class="offer">
            {{#if bundleProducts}}
                <div class="packages">
                    {{#each bundleProducts}}
                        {{#if isCurrent}}
                            <div class="btn rounded translucent bg-paleBlue active package">
                                {{editionId.name}}
                            </div>
                        {{else}}
                            <div class="tooltip package">
                                <a href="/games/{{alias}}" class="btn rounded translucent bg-paleBlue">
                                    {{editionId.name}}
                                </a>
                                {{#if elements.length}}
                                    <div class="prompt">
                                        <ul class="list">
                                            {{#each elements}}
                                                <li class="item">
                                                    {{name}}
                                                </li>
                                            {{/each}}
                                        </ul>
                                    </div>
                                {{/if}}
                            </div>
                        {{/if}}
                    {{/each}}
                </div>
            {{/if}}
            <div class="name">{{product.name}}</div>
            <div class="statuses">
                <div class="status positive">В наличии</div>
                <div class="status positive">Данный товар купили сегодня 30 раз</div>
            </div>
            <div class="description">
                {{product.description}}
            </div>
            <div class="price">
                <div class="toPrice">
                    <span class="value">
                        {{product.priceTo}}
                    </span>
                </div>
                <div class="fromPrice">
                    <span class="value">
                        {{product.priceFrom}}
                    </span>
                </div>
                {{#if discount}}
                    <div class="discount">
                        {{discount}}
                    </div>
                {{/if}}
            </div>
            <div class="actions">
                <button
                    title="{{#if currentProductInCart}}Перейти в корзину покупок{{else}}Добавить данный товар в корзину покупок{{/if}}"
                    class="btn rounded increase bg-pink hover-backlight-blue js-addToCartBtn{{#if currentProductInCart}} js-active{{/if}}"
                    {{#unless currentProductInCart}}
                        data-ds-id="{{product.dsId}}"
                        data-product-id="{{product.id}}"
                    {{/unless}}
                >
                    {{#if currentProductInCart}}В корзине ✔{{else}}В корзину{{/if}}
                </button>
            </div>
            {{#if product.extends.length}}
                <div class="extends">
                    {{#each product.extends}}
                        <div class="tooltip">
                            <button class="btn extend">
                                <img  class="img" src="{{@root.websiteAddress}}{{icon}}" alt="{{text}}" title="{{text}}">
                            </button>
                            <div class="prompt">
                                {{name}}
                            </div>
                        </div>
                    {{/each}}
                </div>
            {{/if}}
        </div>
    </div>
    <div class="contentContainer">
        <div class="main infoBlock">
            <ul class="fieldedList">
                <li class="item">
                    <div class="name">Язык:</div>
                    <div class="value">
                        {{#each product.languages}}
                            {{#if @last}}
                                {{name}}
                            {{else}}
                                {{name}},
                            {{/if}}
                        {{/each}}
                    </div>
                </li>
                <li class="item">
                    <div class="name">Регион активации:</div>
                    <div class="value">
                        {{#each product.activationRegions}}
                            {{#if @last}}
                                {{name}}
                            {{else}}
                                {{name}},
                            {{/if}}
                        {{/each}}
                    </div>
                </li>
                <li class="item">
                    <div class="name">Сервис активации:</div>
                    <div class="value">
                        {{product.activationServiceId.name}}
                    </div>
                </li>
                <li class="item">
                    <div class="name">Жанр:</div>
                    <div class="value">
                        {{#each product.genres}}
                            {{#if @last}}
                                {{name}}
                            {{else}}
                                {{name}},
                            {{/if}}
                        {{/each}}
                    </div>
                </li>
                <li class="item">
                    <div class="name">Платформа:</div>
                    <div class="value">
                        {{product.platformId.name}}
                    </div>
                </li>
                <li class="item">
                    <div class="name">Издатель:</div>
                    <div class="value">
                        {{product.publisherId.name}}
                    </div>
                </li>
                <li class="item">
                    <div class="name">Дата выхода:</div>
                    <div class="value">
                        {{product.releaseDate}}
                    </div>
                </li>
            </ul>
            <div class="gallerySlider js-gameGallerySlider">
                <button class="btn prev increase js-prevBtn">
                    <span class="icon-static icon-static-arrow"></span>
                </button>
                <div class="visibleAreaWrapper">
                    <div class="visibleArea js-visibleArea">
                        <div class="tape js-tape">
                            {{#if product.trailerLink}}
                                <div class="slide js-slide active">
                                    <button class="btn increase video js-playYouTubeVideo" title="Посмотреть трейлер игры" data-link="{{trailerId}}">
                                        <img class="img" src="https://img.youtube.com/vi/{{trailerId}}/maxresdefault.jpg" alt="Трейлер игры {{game.name}}">
                                    </button>
                                </div>
                                {{#each images}}
                                    <div class="slide js-slide{{#if (isLess @index 1)}} active{{/if}}">
                                        <button class="btn increase" title="Открыть на весь экран">
                                            <img class="img" src="{{@root.websiteAddress}}{{name}}" alt="Фото из галереи игы">
                                        </button>
                                    </div>
                                {{/each}}
                            {{else}}
                                {{#each images}}
                                    <div class="slide js-slide{{#if (isLess @index 2)}} active{{/if}}">
                                        <button class="btn increase" title="Открыть на весь экран">
                                            <img class="img" src="{{@root.websiteAddress}}{{name}}" alt="Фото из галереи игы">
                                        </button>
                                    </div>
                                {{/each}}
                            {{/if}}
                        </div>
                    </div>
                </div>
                <button class="btn next increase js-nextBtn">
                    <span class="icon-static icon-static-arrow"></span>
                </button>
            </div>
        </div>
        <div class="fullInfo">
            <div class="sideBar">
                <div class="doubleGameSlider">
                    <div class="title">Вам может понравится</div>
                    <div class="slider">
                        <div class="visibleAreaWrapper">
                            <div class="visibleArea">
                                <div class="tape">
                                    {{#each recProducts}}
                                        <div class="slide{{#iff @index '<=' 2}} active{{/iff}}">
                                            {{> game
                                                id=_id
                                                size='small'
                                            }}
                                        </div>
                                    {{/each}}
                                </div>
                            </div>
                        </div>
                        <div class="slideControls">
                            <button class="btn prev"></button>
                            <div class="progress"></div>
                            <button class="btn next"></button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="info">
                <div class="generalInfo tabs js-gameInfoTabs">
                    <div class="nav">
                        <button class="btn round border big translucent active js-tabBtn" data-target-id="1">Об игре</button>
                        <button class="btn round border big translucent js-tabBtn" data-target-id="2">Активация</button>
                        {{#if product.elements.length}}
                            <button class="btn round border big translucent js-tabBtn" data-target-id="3">Состав набора</button>
                        {{/if}}
                        {{#if seriesProducts.length}}
                            <button class="btn round border big translucent js-tabBtn" data-target-id="4">Игры серии</button>
                        {{/if}}
                    </div>
                    <div class="blocks totalHeight infoBlock">
                        <div class="item active js-tabBlock-1">
                            <p class="paragraph">
                                {{product.description}}
                            </p>
                        </div>
                        <ul class="item bulletedList js-tabBlock-2">
                            {{#each stages}}
                                <li class="item">
                                    {{text}}
                                </li>
                            {{/each}}
                        </ul>
                        {{#if product.elements.length}}
                            <div class="item js-tabBlock-3">
                                {{#if product.editionId}}
                                    <div class="btn rounded bg-paleBlue package">
                                        {{product.editionId.name}}
                                    </div>
                                {{/if}}
                                <ul class="bulletedList">
                                    {{#each product.elements}}
                                        <li class="item">
                                            {{#if gameId}}
                                                <a href="/games/{{gameId}}">
                                                    {{name}}
                                                </a>
                                            {{else}}
                                                {{name}}
                                            {{/if}}
                                        </li>
                                    {{/each}}
                                </ul>
                            </div>
                        {{/if}}
                        {{#if seriesProducts.length}}
                            <div class="item js-tabBlock-4">
                                {{#if seriesIsSlider}}
                                    <div class="slider">
                                        <button class="btn prev increase">
                                            <span class="icon-static icon-static-arrow"></span>
                                        </button>
                                        <div class="visibleAreaWrapper">
                                            <div class="visibleArea">
                                                <div class="tape">
                                {{else}}
                                    <div class="row-game">
                                {{/if}}
                                {{#each seriesProducts}}
                                    {{#if seriesIsSlider}}
                                        <div class="slide{{#if (isLess @index 4)}} active{{/if}}">
                                    {{/if}}
                                        {{> game
                                            size='small'
                                            id=_id
                                        }}
                                    {{#if seriesIsSlider}}
                                        </div>
                                    {{/if}}
                                {{/each}}
                                {{#if seriesIsSlider}}
                                                </div>
                                            </div>
                                        </div>
                                        <button class="btn next increase">
                                            <span class="icon-static icon-static-arrow"></span>
                                        </button>
                                    </div>
                                {{else}}
                                    </div>
                                {{/if}}
                            </div>
                        {{/if}}
                    </div>
                </div>
                <div class="systemInfo">
                    <div class="btn border round big title">Системные требования</div>
                    <ul class="fieldedList infoBlock">
                        {{#if product.os}}
                            <li class="item">
                                <div class="name">ОС:</div>
                                <div class="value">
                                    {{product.os}}
                                </div>
                            </li>
                        {{/if}}
                        <li class="item">
                            <div class="name">Процессор:</div>
                            <div class="value">
                                {{product.cpu}}
                            </div>
                        </li>
                        <li class="item">
                            <div class="name">Видеокарта:</div>
                            <div class="value">
                                {{product.graphicsCard}}
                            </div>
                        </li>
                        <li class="item">
                            <div class="name">Оперативная память:</div>
                            <div class="value">
                                {{product.ram}}
                            </div>
                        </li>
                        <li class="item">
                            <div class="name">Место на диске:</div>
                            <div class="value">
                                {{product.diskMemory}}
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="feedback tabs js-feedbackProductTabs">
                    <div class="nav">
                        <button class="btn border round big translucent active js-tabBtn" data-target-id="1">Отзывы</button>
                        <button class="btn border round big translucent js-tabBtn" data-target-id="2">Комментарии</button>
                    </div>
                    <div class="blocks">
                        <div class="item reviews active js-tabBlock-1">
                            {{#if isProductNoReview}}
                                <form action="/api/products/{{product.id}}/review" method="post" class="addNew infoBlock js-addReviewForm{{#if isProductNotPurchased}} locked{{/if}}">
                                    <div class="starRating js-error-eval">
                                        <div class="label">Оцените игру</div>
                                        <div class="stars">
                                            <input class="input" type="radio" name="eval" value="5" id="star5"{{#if isProductNotPurchased}} disabled{{/if}}>
                                            <label class="star" for="star5">
                                                <span class="icon icon-star"></span>
                                            </label>
                                            <input class="input" type="radio" name="eval" value="4" id="star4"{{#if isProductNotPurchased}} disabled{{/if}}>
                                            <label class="star" for="star4">
                                                <span class="icon icon-star"></span>
                                            </label>
                                            <input class="input" type="radio" name="eval" value="3" id="star3"{{#if isProductNotPurchased}} disabled{{/if}}>
                                            <label class="star" for="star3">
                                                <span class="icon icon-star"></span>
                                            </label>
                                            <input class="input" type="radio" name="eval" value="2" id="star2"{{#if isProductNotPurchased}} disabled{{/if}}>
                                            <label class="star" for="star2">
                                                <span class="icon icon-star"></span>
                                            </label>
                                            <input class="input" type="radio" name="eval" value="1" id="star1"{{#if isProductNotPurchased}} disabled{{/if}}>
                                            <label class="star" for="star1">
                                                <span class="icon icon-star"></span>
                                            </label>
                                        </div>
                                    </div>
                                    <div class="senderField textReview js-error-text">
                                        <div class="autoSizeInput js-autoSizeInput" data-name="text">
                                            <span class="placeholder js-placeholder">Напишите отзыв до 1000 символов</span>
                                            <div class="value js-value"{{#unless isProductNotPurchased}} contentEditable{{/unless}}></div>
                                        </div>
                                        <button class="btn" type="submit"{{#if isProductNotPurchased}} disabled{{/if}}>
                                            <span class="icon icon-send"></span>
                                        </button>
                                    </div>
                                    {{#if isProductNotPurchased}}
                                        <div class="lockBlock">
                                            <span class="icon icon-lock"></span>
                                            <div class="text">
                                                Для предотвращения накрутки, добавление отзыва доступно только авторизованным пользователям после
                                                покупки игры.
                                            </div>
                                        </div>
                                    {{/if}}
                                </form>
                            {{/if}}
                            {{#if product.reviews}}
                                <div class="listItems js-listReviews"{{#if @root.person.login}} data-user-name="{{@root.person.login}}"{{/if}}>
                                    {{#each product.reviews}}
                                        {{> review
                                                userLogin=userId.login
                                                eval=eval
                                                text=text
                                        }}
                                    {{/each}}
                                </div>
                                {{#iff product.reviews.length '>' 3}}
                                    <div class="btn link translucent loadMore">Загрузить еще</div>
                                {{/iff}}
                            {{/if}}
                        </div>
                        <div class="item comments js-tabBlock-2">
                            <form action="/api/comments" method="post" data-skip="3" data-ref="product" data-subject-id="{{product.id}}" class="addNew infoBlock js-commentProductForm{{#unless @root.isAuth}} locked{{/unless}}">
                                <div class="senderField textReview">
                                    <div class="autoSizeInput js-autoSizeInput" data-name="text">
                                        <span class="placeholder js-placeholder">Напишите комментарий до 1000 символов</span>
                                        <div class="value js-value"{{#if @root.isAuth}} contentEditable{{/if}}></div>
                                    </div>
                                    <button class="btn" type="submit"{{#unless @root.isAuth}} disabled{{/unless}}>
                                        <span class="icon icon-send"></span>
                                    </button>
                                </div>
                                {{#unless @root.isAuth}}
                                    <div class="lockBlock">
                                        <span class="icon icon-lock"></span>
                                        <div class="text">
                                            Авторизуйтесь для добавления комментариев.
                                        </div>
                                    </div>
                                {{/unless}}
                            </form>
                            <div class="listItems js-listComments"{{#if @root.person.login}}data-user-name="{{@root.person.login}}{{/if}}">
                                {{#if comments}}
                                    {{#each comments}}
                                        <div class="item comment">
                                            <div class="head">
                                                <a class="btn link" href="/profile/view/{{author.login}}" title="Перейти в профиль пользователя {{author.login}}">{{author.login}}</a>
                                                <!--<div class="reactions">
                                                    <button class="btn active positive">
                                                        <span class="icon icon-thumbsUp"></span> 54
                                                    </button>
                                                    <button class="btn negative">
                                                        <span class="icon icon-thumbsDown"></span> 31
                                                    </button>
                                                </div>-->
                                            </div>
                                            <div class="text">
                                                {{text}}
                                            </div>
                                            <!--<button class="btn link action">Ответить</button>-->
                                        </div>
                                    {{/each}}
                                {{/if}}
                                <!--<div class="item comment">
                                    <div class="head">
                                        <a class="btn link" href="#" title="Перейти в профиль пользователя Айс 214421">Айс 214421</a>
                                        <div class="reactions">
                                            <button class="btn active positive">
                                                <span class="icon icon-thumbsUp"></span> 54
                                            </button>
                                            <button class="btn negative">
                                                <span class="icon icon-thumbsDown"></span> 31
                                            </button>
                                        </div>
                                    </div>
                                    <div class="text">Игра топ, очень понравилась</div>
                                    <button class="btn link action">Ответить</button>
                                    <div class="answers">
                                        <div class="answer">
                                            <div class="head">
                                                <a class="btn link" href="#" title="Перейти в профиль пользователя Айс 214421">Айс 214421</a>
                                                <div class="answerFor">ответ пользователю Айс 214421</div>
                                                <div class="reactions">
                                                    <button class="btn positive">
                                                        <span class="icon icon-thumbsUp"></span> 54
                                                    </button>
                                                    <button class="btn negative active">
                                                        <span class="icon icon-thumbsDown"></span> 31
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="text">Игра топ, очень понравилась</div>
                                            <button class="btn link action">Ответить</button>
                                        </div>
                                        <div class="senderField answerField">
                                            <div class="autoSizeInput">
                                                <span class="placeholder">Напишите Ваш ответ до 1000 символов</span>
                                                <div class="value" contentEditable></div>
                                            </div>
                                            <button class="btn" type="submit">
                                                <span class="icon icon-send"></span>
                                            </button>
                                        </div>
                                    </div>
                                </div>-->
                            </div>
                            {{#iff countComments '>' 3}}
                                <div class="btn link translucent loadMore js-loadMoreCommentBtn">Загрузить еще</div>
                            {{/iff}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{#if lastViewedProducts.length}}
            <div class="lastViews">
                <div class="title">Вы недавно смотрели</div>
                <div class="games">
                    {{#each lastViewedProducts}}
                        {{> game
                            id=viewedProduct._id
                            dsId=viewedProduct.dsId
                            size='small'
                            alias=viewedProduct.alias
                            img=viewedProduct.img
                            name=viewedProduct.name
                            priceTo=viewedProduct.priceTo
                            priceFrom=viewedProduct.priceFrom
                            inFavorites=viewedProduct.inFavorites
                            inCart=viewedProduct.inCart
                        }}
                    {{/each}}
                </div>
            </div>
        {{/if}}
    </div>
</main>